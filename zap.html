<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Automa√ß√£o WhatsApp - Restaurante</title>
  <style>
    body{font-family:Inter,Arial,sans-serif;background:#f4f7fb;margin:0;padding:20px}
    .wrap{max-width:1100px;margin:0 auto}
    .card{background:#fff;padding:18px;border-radius:10px;box-shadow:0 8px 30px rgba(2,6,23,0.06);margin-bottom:18px}
    h1{color:#0f5132;margin:0}
    label{display:block;font-weight:600;margin-top:12px;color:#333}
    input[type="text"], input[type="number"], textarea, select{width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid #e0e6ef;font-size:14px}
    textarea{min-height:90px;resize:vertical}
    .btn{display:inline-block;background:linear-gradient(90deg,#25D366,#128C7E);color:white;padding:10px 14px;border-radius:8px;font-weight:700;border:0;cursor:pointer;margin-top:10px}
    .btn.secondary{background:#1976d2}
    .row{display:flex;gap:12px;align-items:flex-start;margin-top:10px}
    .col{flex:1}
    .small{font-size:13px;color:#666}
    .options-list{margin-top:8px}
    .opt-row{display:flex;gap:8px;align-items:center;margin-bottom:8px}
    .opt-row input[type="text"]{flex:1}
    .danger{background:linear-gradient(90deg,#dc3545,#c82333)}
    #flowPreview{height:200px;font-family:monospace;margin-top:10px}
    .progress{margin-top:8px;background:#eef5f0;padding:8px;border-radius:8px;font-weight:600;color:#333}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>üçΩÔ∏è Automa√ß√£o WhatsApp ‚Äî Restaurante</h1>
      <div class="small">Conecte seu WhatsApp e gerencie automa√ß√µes, upsells e disparos em massa.</div>

      <label>Conex√£o</label>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn" id="connectBtn" onclick="connectWhatsApp()">Conectar WhatsApp</button>
        <button class="btn secondary" id="disconnectBtn" onclick="disconnectWhatsApp()" style="display:none">Desconectar</button>
        <div id="status" style="margin-left:12px" class="small">N√£o conectado</div>
      </div>
      <div id="qrContainer" style="margin-top:10px"></div>  <!-- Aqui o QR Code ser√° exibido -->
    </div>

    <!-- Outras se√ß√µes do formul√°rio seguem aqui... -->

  </div>

<script>
  let ws = null;

  // Fun√ß√£o de conex√£o com o WebSocket
  function connectWhatsApp() {
    if (ws && ws.readyState === WebSocket.OPEN) return alert('J√° conectado');
    const origin = window.location.origin;
    const url = (location.hostname === 'localhost' || location.hostname === '127.0.0.1') ? 'ws://localhost:3000' : (origin.startsWith('https') ? origin.replace('https','wss') : origin.replace('http','ws'));
    ws = new WebSocket(url);

    ws.onopen = () => {
      document.getElementById('status').textContent = 'Conectando...';
      ws.send(JSON.stringify({ action: 'connect' }));
    };

    ws.onmessage = evt => {
      const d = JSON.parse(evt.data);
      if (d.type === 'qr') {
        // Exibindo o QR Code recebido do servidor
        document.getElementById('qrContainer').innerHTML = `<img src="${d.qr}" style="max-width:260px" />`;
        document.getElementById('status').textContent = 'Escaneie o QR code';
      } else if (d.type === 'ready') {
        document.getElementById('status').textContent = '‚úÖ WhatsApp conectado';
        document.getElementById('qrContainer').innerHTML = '';  // Limpa o QR Code quando o WhatsApp est√° pronto
        document.getElementById('disconnectBtn').style.display = 'inline-block';
      }
    };

    ws.onerror = () => document.getElementById('status').textContent = 'Erro na conex√£o';
    ws.onclose = () => {
      document.getElementById('status').textContent = 'Conex√£o encerrada';
      document.getElementById('disconnectBtn').style.display = 'none';
    };
  }

  // Fun√ß√£o de desconex√£o do WebSocket
  function disconnectWhatsApp() {
    if (ws && ws.readyState === WebSocket.OPEN) ws.close();
    ws = null;
    document.getElementById('status').textContent = 'Desconectado';
  }
</script>

</body>
</html>
